<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Material Animation Demo</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <!-- Material Animations CSS -->
  <link href="styles/material-animations.css" rel="stylesheet">
</head>
<body>
  <div class="container my-4">
    <h1>Material Animation Demo</h1>
    <p class="lead">Demo tích hợp MaterialManager vào ứng dụng</p>
    <hr>
    
    <div id="app-container">
      <!-- Container để hiển thị các ảnh/video và các nút hiệu ứng -->
      <div class="row" id="media-list">
        <!-- Media items sẽ được thêm ở đây bởi JavaScript -->
      </div>
    </div>
    
    <div class="mt-4">
      <h3>Cách sử dụng</h3>
      <ol>
        <li>Click vào nút "Vào" để chọn hiệu ứng xuất hiện</li>
        <li>Click vào nút "Kết hợp" để chọn hiệu ứng kết hợp</li>
        <li>Click vào nút "Ra" để chọn hiệu ứng biến mất</li>
        <li>Sau khi chọn, hiệu ứng sẽ được áp dụng cho ảnh/video tương ứng</li>
      </ol>
    </div>
  </div>
  
  <!-- Mô phỏng import file JSON từ CapCut -->
  <div class="container my-4">
    <div class="card">
      <div class="card-header">
        Import Material Animations từ CapCut
      </div>
      <div class="card-body">
        <div class="mb-3">
          <label for="draftContentFile" class="form-label">Chọn file draft_content.json từ CapCut</label>
          <input class="form-control" type="file" id="draftContentFile" accept=".json">
        </div>
        <button class="btn btn-primary" id="importBtn">Import</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="scripts/material-manager.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Khởi tạo MaterialManager
      MaterialManager.init();
      
      // Danh sách ảnh/video giả lập
      const mediaItems = [
        { id: 'img1', type: 'image', name: 'Ảnh 1', url: 'path/to/image1.jpg' },
        { id: 'img2', type: 'image', name: 'Ảnh 2', url: 'path/to/image2.jpg' },
        { id: 'vid1', type: 'video', name: 'Video 1', url: 'path/to/video1.mp4' }
      ];
      
      // Container cho danh sách media
      const mediaListContainer = document.getElementById('media-list');
      
      // Xử lý khi áp dụng animation
      function handleApplyAnimation(mediaItem, animation, animationType) {
        console.log(`Đã áp dụng ${animationType} animation: ${animation.name} cho ${mediaItem.name}`);
        
        // Hiển thị thông báo
        const itemElement = document.getElementById(`media-item-${mediaItem.id}`);
        if (itemElement) {
          const animationInfoContainer = itemElement.querySelector('.animation-info-container');
          if (animationInfoContainer) {
            const animationInfo = animationInfoContainer.querySelector(`.${animationType}-animation-info`);
            if (animationInfo) {
              // Nếu animation là None thì xóa thông tin
              if (animation.name === 'None') {
                animationInfo.style.display = 'none';
              } else {
                animationInfo.textContent = `${animationType === 'in' ? 'Vào' : animationType === 'out' ? 'Ra' : 'Kết hợp'}: ${animation.name}`;
                animationInfo.style.display = 'block';
              }
            }
          }
        }
        
        // Trong ứng dụng thực tế, bạn sẽ lưu animation này vào cấu trúc dữ liệu của mình
      }
      
      // Tạo các item ảnh/video
      mediaItems.forEach(item => {
        // Tạo card để hiển thị item
        const cardCol = document.createElement('div');
        cardCol.className = 'col-md-4 mb-3';
        
        const card = document.createElement('div');
        card.id = `media-item-${item.id}`;
        card.className = 'card';
        
        // Tạo phần header của card
        const cardHeader = document.createElement('div');
        cardHeader.className = 'card-header';
        cardHeader.textContent = item.name;
        card.appendChild(cardHeader);
        
        // Tạo phần body của card
        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';
        
        // Tạo preview ảnh/video
        const preview = document.createElement('div');
        preview.className = 'media-preview mb-3';
        preview.style.height = '150px';
        preview.style.backgroundColor = item.type === 'video' ? '#8a2be2' : '#4169e1';
        preview.style.display = 'flex';
        preview.style.alignItems = 'center';
        preview.style.justifyContent = 'center';
        preview.style.color = 'white';
        preview.style.fontWeight = 'bold';
        preview.textContent = item.type === 'video' ? 'VIDEO' : 'IMAGE';
        cardBody.appendChild(preview);
        
        // Container cho thông tin animation
        const animationInfoContainer = document.createElement('div');
        animationInfoContainer.className = 'animation-info-container mb-3';
        
        // Thông tin hiệu ứng vào
        const inAnimationInfo = document.createElement('div');
        inAnimationInfo.className = 'animation-info in-animation-info';
        inAnimationInfo.style.display = 'none';
        inAnimationInfo.style.backgroundColor = '#e6f7ff';
        inAnimationInfo.style.padding = '5px 10px';
        inAnimationInfo.style.borderRadius = '4px';
        inAnimationInfo.style.marginBottom = '5px';
        animationInfoContainer.appendChild(inAnimationInfo);
        
        // Thông tin hiệu ứng kết hợp
        const groupAnimationInfo = document.createElement('div');
        groupAnimationInfo.className = 'animation-info group-animation-info';
        groupAnimationInfo.style.display = 'none';
        groupAnimationInfo.style.backgroundColor = '#f0f0f0';
        groupAnimationInfo.style.padding = '5px 10px';
        groupAnimationInfo.style.borderRadius = '4px';
        groupAnimationInfo.style.marginBottom = '5px';
        animationInfoContainer.appendChild(groupAnimationInfo);
        
        // Thông tin hiệu ứng ra
        const outAnimationInfo = document.createElement('div');
        outAnimationInfo.className = 'animation-info out-animation-info';
        outAnimationInfo.style.display = 'none';
        outAnimationInfo.style.backgroundColor = '#fff1f0';
        outAnimationInfo.style.padding = '5px 10px';
        outAnimationInfo.style.borderRadius = '4px';
        animationInfoContainer.appendChild(outAnimationInfo);
        
        cardBody.appendChild(animationInfoContainer);
        
        // Thêm card vào container
        card.appendChild(cardBody);
        
        // Thêm các nút hiệu ứng vào/ra/kết hợp
        // Tạo container cho các nút
        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'animation-buttons card-footer';
        
        // Tạo nút hiệu ứng vào (in)
        const inButton = document.createElement('button');
        inButton.className = 'btn btn-sm btn-outline-primary';
        inButton.innerHTML = '<i class="fas fa-sign-in-alt"></i> Vào';
        
        // Tạo nút hiệu ứng kết hợp (group)
        const groupButton = document.createElement('button');
        groupButton.className = 'btn btn-sm btn-outline-secondary';
        groupButton.innerHTML = '<i class="fas fa-object-group"></i> Kết hợp';
        
        // Tạo nút hiệu ứng ra (out)
        const outButton = document.createElement('button');
        outButton.className = 'btn btn-sm btn-outline-danger';
        outButton.innerHTML = '<i class="fas fa-sign-out-alt"></i> Ra';
        
        // Thêm các nút vào container
        buttonContainer.appendChild(inButton);
        buttonContainer.appendChild(groupButton);
        buttonContainer.appendChild(outButton);
        
        // Tạo các dropdown
        const inDropdown = MaterialManager.createAnimationDropdown(buttonContainer, 'in', animation => {
          handleApplyAnimation(item, animation, 'in');
        });
        
        const groupDropdown = MaterialManager.createAnimationDropdown(buttonContainer, 'group', animation => {
          handleApplyAnimation(item, animation, 'group');
        });
        
        const outDropdown = MaterialManager.createAnimationDropdown(buttonContainer, 'out', animation => {
          handleApplyAnimation(item, animation, 'out');
        });
        
        // Thêm sự kiện click cho các nút
        inButton.addEventListener('click', function(event) {
          event.stopPropagation();
          inDropdown.classList.toggle('show');
          groupDropdown.classList.remove('show');
          outDropdown.classList.remove('show');
          
          // Định vị dropdown
          const rect = inButton.getBoundingClientRect();
          inDropdown.style.position = 'absolute';
          inDropdown.style.top = `${rect.bottom}px`;
          inDropdown.style.left = `${rect.left}px`;
          
          // Đóng dropdown khi click ngoài
          const closeDropdown = function(e) {
            if (!inDropdown.contains(e.target) && e.target !== inButton) {
              inDropdown.classList.remove('show');
              document.removeEventListener('click', closeDropdown);
            }
          };
          
          document.addEventListener('click', closeDropdown);
        });
        
        groupButton.addEventListener('click', function(event) {
          event.stopPropagation();
          groupDropdown.classList.toggle('show');
          inDropdown.classList.remove('show');
          outDropdown.classList.remove('show');
          
          // Định vị dropdown
          const rect = groupButton.getBoundingClientRect();
          groupDropdown.style.position = 'absolute';
          groupDropdown.style.top = `${rect.bottom}px`;
          groupDropdown.style.left = `${rect.left}px`;
          
          // Đóng dropdown khi click ngoài
          const closeDropdown = function(e) {
            if (!groupDropdown.contains(e.target) && e.target !== groupButton) {
              groupDropdown.classList.remove('show');
              document.removeEventListener('click', closeDropdown);
            }
          };
          
          document.addEventListener('click', closeDropdown);
        });
        
        outButton.addEventListener('click', function(event) {
          event.stopPropagation();
          outDropdown.classList.toggle('show');
          inDropdown.classList.remove('show');
          groupDropdown.classList.remove('show');
          
          // Định vị dropdown
          const rect = outButton.getBoundingClientRect();
          outDropdown.style.position = 'absolute';
          outDropdown.style.top = `${rect.bottom}px`;
          outDropdown.style.left = `${rect.left}px`;
          
          // Đóng dropdown khi click ngoài
          const closeDropdown = function(e) {
            if (!outDropdown.contains(e.target) && e.target !== outButton) {
              outDropdown.classList.remove('show');
              document.removeEventListener('click', closeDropdown);
            }
          };
          
          document.addEventListener('click', closeDropdown);
        });
        
        card.appendChild(buttonContainer);
        cardCol.appendChild(card);
        mediaListContainer.appendChild(cardCol);
      });
      
      // Xử lý import file draft_content.json
      const importBtn = document.getElementById('importBtn');
      const draftContentFileInput = document.getElementById('draftContentFile');
      
      importBtn.addEventListener('click', function() {
        if (draftContentFileInput.files.length > 0) {
          const file = draftContentFileInput.files[0];
          const reader = new FileReader();
          
          reader.onload = function(e) {
            try {
              const draftContent = JSON.parse(e.target.result);
              MaterialManager.updateFromDraftContent(draftContent);
              alert('Import thành công! Danh sách material animations đã được cập nhật.');
              
              // Reload trang để hiển thị danh sách mới
              location.reload();
            } catch (error) {
              console.error('Error parsing JSON:', error);
              alert('Lỗi khi đọc file JSON');
            }
          };
          
          reader.readAsText(file);
        } else {
          alert('Vui lòng chọn file draft_content.json');
        }
      });
    });
  </script>
</body>
</html> 